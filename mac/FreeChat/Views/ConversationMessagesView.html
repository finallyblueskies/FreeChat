<html>
  <head>
    <style>
      :root {
        color-scheme: light dark;
      }
      body {
        margin: 0;
        padding: 8px 4px;
        font: -apple-system-body;
      }
      img {
        max-width: 100%;
      }
      .message-view {
        display: flex;
        align-items: flex-start;
        padding: 3px 8px;
      }
      .avatar {
        width: 40px;
        height: 40px;
        box-shadow: 0 0.5px 2px rgba(0, 0, 0, 0.3);
        margin-right: 8px;
      }
      .content {
        flex: 1;
      }
      .info-line {
        display: flex;
        align-items: center;
        font-size: 10px;
        padding: 8px 0 0 4px;
      }
      .info-text {
        margin-right: 4px;
        opacity: 0.6;
      }
      .popover {
        display: none;
        position: absolute;
        padding: 8px;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        max-width: 300;
        margin-top: 5px;
      }
      .popover.show {
        display: block;
      }
      @media (prefers-color-scheme: light) {
        .popover {
          background: white;
          border: 1px solid #ccc;
        }
      }
      @media (prefers-color-scheme: dark) {
        .popover {
          background: #333;
          border: 1px solid #555;
          color: white;
        }
      }
      .mini-info {
        display: flex;
        align-items: center;
        opacity: 0;
        margin-left: 2px;
        transition: opacity 0.3s linear;
      }
      .content:hover .mini-info,
      .mini-info.keep-visible {
        opacity: 1;
      }
      .message-text {
        margin-bottom: 8px;
        padding: 0 3px;
      }
      .menu-button {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
        margin: 0 4px 0 2px;
      }
      .menu-icon {
        width: 12px;
        height: 12px;
      }
      menu {
        display: none;
        position: absolute;
        padding: 4px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        list-style: none;
        margin: 0;
        margin-top: 5px;
        font-size: 13px;
        text-align: left;
      }
      menu.show {
        display: block;
      }
      @media (prefers-color-scheme: light) {
        menu {
          background: white;
          border: 1px solid #ccc;
        }
      }
      @media (prefers-color-scheme: dark) {
        menu {
          background: #333;
          border: 1px solid #555;
        }
        menu li {
          color: white;
        }
      }
      menu li {
        border-radius: 4px;
        padding: 4px 8px;
        cursor: pointer;
      }
      @media (prefers-color-scheme: light) {
        menu li:hover {
          background: #f0f0f0;
        }
      }
      @media (prefers-color-scheme: dark) {
        menu li:hover {
          background: #444;
        }
      }
    </style>
  </head>
  <svg style="display: none">
    <symbol id="user-avatar" width="40" height="40" viewBox="0 0 40 40">
      <circle r="20" cx="20" cy="20" fill="#CEA5EE" />
      <path
        d="M11.7266 23V21L9.10938 17.3633H10.7695L12.4531
      19.7773H12.4961L14.1758 17.3633H15.8398L13.2227 21V23H11.7266ZM19.582
      23.1289C18.8685 23.1289 18.2474 23.0091 17.7188 22.7695C17.1901 22.5273
      16.7799 22.1862 16.4883 21.7461C16.1992 21.306 16.0547 20.7852 16.0547
      20.1836V20.1758C16.0547 19.5742 16.1992 19.0534 16.4883 18.6133C16.7799
      18.1732 17.1901 17.8333 17.7188 17.5938C18.2474 17.3542 18.8685 17.2344
      19.582 17.2344C20.2956 17.2344 20.9167 17.3542 21.4453 17.5938C21.974
      17.8333 22.3828 18.1732 22.6719 18.6133C22.9635 19.0534 23.1094 19.5742
      23.1094 20.1758V20.1836C23.1094 20.7852 22.9635 21.306 22.6719
      21.7461C22.3828 22.1862 21.974 22.5273 21.4453 22.7695C20.9167 23.0091
      20.2956 23.1289 19.582 23.1289ZM19.582 21.957C19.9857 21.957 20.3372
      21.8854 20.6367 21.7422C20.9388 21.5964 21.1719 21.3906 21.3359
      21.125C21.5 20.8568 21.582 20.543 21.582 20.1836V20.1758C21.582 19.8138
      21.5 19.5013 21.3359 19.2383C21.1719 18.9727 20.9388 18.7669 20.6367
      18.6211C20.3372 18.4753 19.9857 18.4023 19.582 18.4023C19.1758 18.4023
      18.8229 18.4753 18.5234 18.6211C18.224 18.7669 17.9922 18.9727 17.8281
      19.2383C17.6641 19.5013 17.582 19.8138 17.582 20.1758V20.1836C17.582
      20.543 17.6641 20.8568"
        fill="black"
      />
    </symbol>

    <symbol viewBox="0 0 20.2832 19.9316" id="circle-ellipsis">
      <g>
        <rect height="19.9316" opacity="0" width="20.2832" x="0" y="0" />
        <path
          d="M9.96094 19.9219C15.4102 19.9219 19.9219 15.4004 19.9219 9.96094C19.9219 4.51172 15.4004 0 9.95117 0C4.51172 0 0 4.51172 0 9.96094C0 15.4004 4.52148 19.9219 9.96094 19.9219ZM9.96094 18.2617C5.35156 18.2617 1.66992 14.5703 1.66992 9.96094C1.66992 5.35156 5.3418 1.66016 9.95117 1.66016C14.5605 1.66016 18.2617 5.35156 18.2617 9.96094C18.2617 14.5703 14.5703 18.2617 9.96094 18.2617Z"
          fill="#ffffff"
          fill-opacity="0.85"
        />
        <path
          d="M14.5117 11.3672C15.2832 11.3672 15.9277 10.7324 15.9277 9.95117C15.9277 9.16992 15.2832 8.53516 14.5117 8.53516C13.7305 8.53516 13.0957 9.16992 13.0957 9.95117C13.0957 10.7324 13.7305 11.3672 14.5117 11.3672Z"
          fill="#ffffff"
          fill-opacity="0.85"
        />
        <path
          d="M9.95117 11.3672C10.7324 11.3672 11.3672 10.7324 11.3672 9.95117C11.3672 9.16992 10.7324 8.53516 9.95117 8.53516C9.16992 8.53516 8.53516 9.16992 8.53516 9.95117C8.53516 10.7324 9.16992 11.3672 9.95117 11.3672Z"
          fill="#ffffff"
          fill-opacity="0.85"
        />
        <path
          d="M5.40039 11.3672C6.17188 11.3672 6.80664 10.7324 6.80664 9.95117C6.80664 9.16992 6.16211 8.53516 5.40039 8.53516C4.61914 8.53516 3.98438 9.16992 3.98438 9.95117C3.98438 10.7324 4.61914 11.3672 5.40039 11.3672Z"
          fill="#ffffff"
          fill-opacity="0.85"
        />
      </g>
    </symbol>

    <symbol viewBox="0 0 20.2539 21.8066" id="thumbs-up">
      <g>
        <rect height="21.8066" opacity="0" width="20.2539" x="0" y="0" />
        <path
          d="M0 14.3848C0 17.5391 2.06055 20.1953 4.55078 20.1953L7.66602 20.1953C8.90625 20.8496 10.4102 21.2305 12.0898 21.2305L13.3984 21.2305C14.5703 21.2305 15.5859 21.1621 16.2598 20.9961C17.5684 20.6738 18.3887 19.7656 18.3887 18.6133C18.3887 18.3691 18.3496 18.1543 18.291 17.9395C18.9355 17.4512 19.2969 16.7383 19.2969 15.957C19.2969 15.5762 19.2188 15.1953 19.082 14.8926C19.5215 14.4434 19.7656 13.7891 19.7656 13.1055C19.7656 12.666 19.6582 12.1973 19.4727 11.8555C19.7363 11.4746 19.8926 10.9375 19.8926 10.3711C19.8926 8.96484 18.7891 7.85156 17.3828 7.85156L13.8184 7.85156C13.6035 7.85156 13.4668 7.75391 13.4668 7.56836C13.4668 6.55273 15.0684 4.16992 15.0684 2.25586C15.0684 0.9375 14.1504 0 12.8906 0C11.9629 0 11.3379 0.478516 10.7227 1.65039C9.58008 3.84766 8.21289 5.82031 5.98633 8.53516L4.19922 8.53516C1.875 8.53516 0 11.1621 0 14.3848ZM5.49805 14.3359C5.49805 12.2949 5.95703 10.9961 7.22656 9.28711C8.64258 7.39258 10.6055 5.12695 12.0215 2.31445C12.373 1.60156 12.6074 1.44531 12.9492 1.44531C13.3496 1.44531 13.623 1.72852 13.623 2.25586C13.623 3.7793 12.0215 6.08398 12.0215 7.56836C12.0215 8.64258 12.9004 9.29688 14.0234 9.29688L17.3828 9.29688C17.9883 9.29688 18.4473 9.75586 18.4473 10.3711C18.4473 10.8203 18.3008 11.1035 17.9395 11.4746C17.7637 11.6309 17.7441 11.8262 17.8906 12.0117C18.1934 12.4609 18.3203 12.7344 18.3203 13.1055C18.3203 13.5449 18.1152 13.9258 17.6855 14.248C17.4512 14.4336 17.3535 14.6777 17.4902 14.9707C17.7344 15.4102 17.8516 15.6152 17.8516 15.957C17.8516 16.4551 17.5293 16.8359 16.8457 17.1875C16.6309 17.3145 16.582 17.4902 16.6699 17.6953C16.9043 18.2812 16.9336 18.3691 16.9336 18.6133C16.9336 19.0625 16.6016 19.4238 15.918 19.5996C15.3613 19.7363 14.4727 19.7949 13.4082 19.7949L12.1973 19.7949C8.17383 19.7949 5.49805 17.5098 5.49805 14.3359ZM1.44531 14.3848C1.44531 11.9531 2.75391 9.98047 4.19922 9.98047C4.48242 9.98047 4.76562 9.98047 5.04883 9.98047C4.35547 11.2891 4.05273 12.6562 4.05273 14.3066C4.05273 16.0547 4.67773 17.5781 5.80078 18.7402C5.38086 18.7402 4.9707 18.7402 4.55078 18.7402C2.90039 18.7402 1.44531 16.748 1.44531 14.3848Z"
          fill="#ffffff"
          fill-opacity="0.85"
        />
      </g>
    </symbol>

    <symbol width="20.2539" height="21.2793" id="thumbs-down">
      <g>
        <rect height="21.2793" opacity="0" width="20.2539" x="0" y="0" />
        <path
          d="M19.8926 6.85547C19.8926 3.69141 17.832 1.04492 15.3418 1.04492L12.2266 1.04492C10.9863 0.390625 9.48242 0 7.80273 0L6.49414 0C5.32227 0 4.30664 0.0683594 3.63281 0.244141C2.32422 0.556641 1.50391 1.47461 1.50391 2.62695C1.50391 2.86133 1.54297 3.08594 1.60156 3.29102C0.957031 3.78906 0.595703 4.49219 0.595703 5.2832C0.595703 5.66406 0.664062 6.03516 0.810547 6.34766C0.371094 6.79688 0.117188 7.45117 0.117188 8.13477C0.117188 8.57422 0.234375 9.04297 0.419922 9.38477C0.15625 9.76562 0 10.3027 0 10.8594C0 12.2754 1.10352 13.3887 2.50977 13.3887L6.07422 13.3887C6.28906 13.3887 6.42578 13.4863 6.42578 13.6719C6.42578 14.6875 4.82422 17.0703 4.82422 18.9844C4.82422 20.3027 5.74219 21.2402 7.00195 21.2402C7.92969 21.2402 8.55469 20.7617 9.16016 19.5898C10.3125 17.3828 11.6797 15.4199 13.9062 12.7051L15.6934 12.7051C18.0176 12.7051 19.8926 10.0781 19.8926 6.85547ZM14.3945 6.9043C14.3945 8.94531 13.9355 10.2441 12.666 11.9531C11.25 13.8379 9.27734 16.1133 7.87109 18.9258C7.50977 19.6289 7.28516 19.7949 6.94336 19.7949C6.54297 19.7949 6.26953 19.5117 6.26953 18.9844C6.26953 17.4512 7.87109 15.1465 7.87109 13.6719C7.87109 12.5977 6.99219 11.9434 5.86914 11.9434L2.50977 11.9434C1.9043 11.9434 1.44531 11.4844 1.44531 10.8594C1.44531 10.4102 1.58203 10.127 1.95312 9.76562C2.12891 9.60938 2.14844 9.4043 2.00195 9.22852C1.69922 8.7793 1.5625 8.50586 1.5625 8.13477C1.5625 7.68555 1.77734 7.31445 2.20703 6.98242C2.44141 6.80664 2.53906 6.5625 2.39258 6.26953C2.1582 5.83008 2.04102 5.625 2.04102 5.2832C2.04102 4.78516 2.36328 4.39453 3.04688 4.04297C3.26172 3.92578 3.31055 3.75 3.21289 3.53516C2.98828 2.95898 2.95898 2.87109 2.95898 2.62695C2.95898 2.17773 3.28125 1.81641 3.96484 1.64062C4.52148 1.49414 5.41016 1.43555 6.48438 1.43555L7.69531 1.43555C11.7188 1.44531 14.3945 3.73047 14.3945 6.9043ZM18.4473 6.85547C18.4473 9.27734 17.1387 11.2598 15.6934 11.2598C15.4102 11.2598 15.127 11.2598 14.8438 11.2598C15.5371 9.94141 15.8398 8.57422 15.8398 6.93359C15.8398 5.18555 15.2148 3.66211 14.0918 2.5C14.502 2.5 14.9219 2.5 15.3418 2.5C16.9922 2.5 18.4473 4.48242 18.4473 6.85547Z"
          fill="#ffffff"
          fill-opacity="0.85"
        />
      </g>
    </symbol>
  </svg>
  <body>
    %MESSAGES%
  </body>
  <script>
    function handleFeedback(messageId, direction) {
      webkit.messageHandlers.feedbackAction.postMessage({
        messageId: messageId,
        thumbDirection: direction,
      });
    }

    function messageEl(id) {
      return document.querySelector(`[data-id="${id}"]`);
    }

    function showMenu(messageId) {
      const menu = messageEl(messageId).querySelector("menu");
      menu.classList.add("show");
      messageEl(messageId)
        .querySelector(".mini-info")
        .classList.add("keep-visible");

      const close = () => {
        menu.classList.remove("show");
        console.log("a");
        messageEl(messageId)
          .querySelector(".mini-info")
          .classList.remove("keep-visible");
        document.removeEventListener("click", close);
      };
      setTimeout(() => {
        document.addEventListener("click", close);
      });
    }

    function showAdvancedDetails(messageId) {
      const popover = messageEl(messageId).querySelector(".popover");
      popover.classList.add("show");

      const close = () => {
        popover.classList.remove("show");

        messageEl(messageId)
          .querySelector(".mini-info")
          .classList.remove("keep-visible");
        document.removeEventListener("click", close);
      };
      setTimeout(() => {
        messageEl(messageId)
          .querySelector(".mini-info")
          .classList.add("keep-visible");
        document.addEventListener("click", close);
      });
    }

    function copyMessage(messageId) {
      const text =
        messageEl(messageId).querySelector(".message-text").textContent;
      navigator.clipboard.writeText(text);
    }
  </script>
</html>
